<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Search Results</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      background: #f4f4f4;
    }
    .result {
      background: white;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .result a {
      text-decoration: none;
      font-weight: bold;
      font-size: 1.2rem;
      color: #0077b6;
    }
    .result p {
      margin-top: 0.5rem;
      color: #444;
    }
  </style>
</head>
<body>
  <h1>Search Results</h1>
  <div id="results">Loading...</div>

  <script>
    const query = new URLSearchParams(window.location.search).get("q")?.toLowerCase();
    const resultsDiv = document.getElementById("results");

    const pages = [
      { title: "Home", url: "index.html" },
      { title: "Water Footprint", url: "waterfootprint.html" },
      { title: "Time for Action", url: "timeforaction.html" },
      { title: "Resources", url: "resources.html" },
      { title: "About Us", url: "about.html" }
    ];

    if (!query) {
      resultsDiv.innerHTML = "<p>Please enter a search query.</p>";
    } else {
      Promise.all(
        pages.map(page =>
          fetch(page.url)
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const doc = parser.parseFromString(html, "text/html");

              const text = doc.body?.innerText?.toLowerCase() || "";

              if (text.includes(query)) {
                // Try to get the first meaningful paragraph
                let preview = doc.querySelector("p")?.innerText || "No description available.";

                return `
                  <div class="result">
                    <a href="${page.url}">${page.title}</a>
                    <p>${preview}</p>
                  </div>
                `;
              }

              return null;
            })
            .catch(() => null)
        )
      ).then(results => {
        const filtered = results.filter(Boolean);
        if (filtered.length > 0) {
          resultsDiv.innerHTML = filtered.join("");
        } else {
          resultsDiv.innerHTML = `<p>No results found for "<strong>${query}</strong>".</p>`;
        }
      });
    }
  </script>
</body>
</html>
